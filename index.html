
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="introduction">Introduction</a>
          </li>
          <li>
            <a href="#localization" class="toc-h1 toc-link" data-title="localization">Localization</a>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="authentication">Authentication</a>
          </li>
          <li>
            <a href="#barcode-scanners" class="toc-h1 toc-link" data-title="barcode-scanners">Barcode Scanners</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#introduction" class="toc-h2 toc-link" data-title="introduction">Introduction</a>
                  </li>
                  <li>
                    <a href="#register-a-new-barcode-scanner" class="toc-h2 toc-link" data-title="register-a-new-barcode-scanner">Register a new barcode scanner</a>
                  </li>
                  <li>
                    <a href="#get-a-list-of-projects-for-a-specific-barcode-scanner" class="toc-h2 toc-link" data-title="get-a-list-of-projects-for-a-specific-barcode-scanner">Get a list of projects for a specific Barcode Scanner</a>
                  </li>
                  <li>
                    <a href="#get-a-list-of-scannable-barcodes-for-a-specific-barcode-scanner" class="toc-h2 toc-link" data-title="get-a-list-of-scannable-barcodes-for-a-specific-barcode-scanner">Get a list of scannable barcodes for a specific Barcode Scanner</a>
                  </li>
                  <li>
                    <a href="#submit-local-scan-actions" class="toc-h2 toc-link" data-title="submit-local-scan-actions">Submit local scan actions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="errors">Errors</a>
          </li>
          <li>
            <a href="#changelog" class="toc-h1 toc-link" data-title="changelog">Changelog</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#2018-06-24" class="toc-h2 toc-link" data-title="2018-06-24">2018/06/24</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='mailto:development@eskesmedia.nl'>Send us an email</a></li>
            <li><a href='https://www.eskesmedia.nl'>Copyright Eskes Media B.V.</a></li>
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the TicketJames API. Use our API to register barcode scanners and synchronize scans.</p>

<p>The TicketJames API is a work in progress and currently under heavy development.</p>

<p>Currently, the only function of this API is to register mobile phones (Android, iOS) as barcode scanners. In future releases, API functionality will probably be expanded with:</p>

<ul>
<li>activity callbacks</li>
<li>coupon check</li>
<li>barcode check</li>
</ul>
<h1 id='localization'>Localization</h1>
<p>TicketJames.com supports multiple languages:</p>

<ul>
<li>English (en)</li>
<li>Dutch (nl) <strong>(default)</strong></li>
<li>Germen (de)</li>
<li>French (fr)</li>
</ul>

<p>The outputted format in the API is localized, when the locale parameter is present in the URI: </p>

<ul>
<li><code>https://api.ticketjames.com/nl/api/v1/&lt;endpoint&gt;</code></li>
<li><code>https://api.ticketjames.com/en/api/v1/&lt;endpoint&gt;</code></li>
<li><code>https://api.ticketjames.com/de/api/v1/&lt;endpoint&gt;</code></li>
</ul>

<aside class="notice">
Status messages will always be in English. When information is unavailable in the requested language, the projects default locale will be used.
</aside>
<h1 id='authentication'>Authentication</h1>
<p>After a successful registration, the API returns a <code>key</code>. This key is needed for all communication. Provide the <code>key</code> as a header in each request.</p>
<h1 id='barcode-scanners'>Barcode Scanners</h1><h2 id='introduction'>Introduction</h2>
<p>This part of the API is aimed at developers who are building a &#39;barcode scanning app&#39;, either on mobile or desktop devices. There are two possible uses for this:</p>

<ul>
<li>Register a barcode scanner and use it &#39;online only&#39;, to check the validity of scanned barcodes.</li>
<li>Register a barcode scanner and use it &#39;offline first, sync later&#39;, to download a batch of available barcodes and check the validity of scanned barcodes on the device, and sync the data every once in a while.</li>
</ul>

<p>The latter is the suggested method. When using &#39;online only&#39;, you can skip &#39;get a list of projects&#39; and &#39;get a list of scannable barcodes&#39;, since you&#39;ll check every barcode directly with the API.</p>
<h2 id='register-a-new-barcode-scanner'>Register a new barcode scanner</h2><pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.ticketjames.com/nl/api/v1/barcode-scanners"</span>
  -X POST
  -d <span class="s1">'{"devise_uid":"65888ba4-9570-43e7-b701-71cb3f4d2549", "user_agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143", "type":"project", id":"2", "key":"0e3e0fee239d849b82b5db788ddcb8e3"}'</span> 
  -H <span class="s2">"Content-Type: application/json"</span>
</code></pre>
<blockquote>
<p>The above command returns a <code>HTTP 200</code> status and JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Congratulations, you now have access to 'Demo Project', 432 tickets will be imported."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f1f604bc31f98cc0544853cd48bc90c6"</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<p>This endpoint registers a new devise. After registration, the admin user will see this devise appear (in real time) in the &#39;barcode scanners&#39; option in the backoffice. He has the option to rename the devise or block permissions. The scanner devise should store the key, as it is used in future communication.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>POST https://api.ticketjames.com/nl/api/v1/barcode-scanners</code></p>
<h3 id='obtain-parameters-from-qr-code'>Obtain parameters from QR code</h3>
<p>How does devise registration work? The project owner invites an employee to scan the tickets for his event(s). The project owner prints/shows a special QR code from the TicketJames backoffice. By scanning this code, the employees phone is now registered to the designated event(s). The secret is in the QR code. When scanned, the QR code will read something like this:</p>

<p><code>eyJ0eXBlIjoicHJvamVjdCIsICJpZCI6Miwia2V5IjoiMGUzZTBmZWUyMzlkODQ5YjgyYjVkYjc4OGRkY2I4ZTMifQ==</code></p>

<p>Your software should at this point think: <em>hey, this looks like a Base64 encrypted string, I&#39;ll decode it!</em>.</p>

<p>The string above, decodes to:</p>

<p><code>{&quot;type&quot;:&quot;project&quot;, &quot;id&quot;:2,&quot;key&quot;:&quot;0e3e0fee239d849b82b5db788ddcb8e3&quot;}</code></p>

<p>The decoded parameters can then be used to register the devise with a POST to the <code>barcode-scanners</code> endpoint.</p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>devise_uid</td>
<td>true</td>
<td>This is the primary key for the devise in TicketJames&#39; backoffice.</td>
</tr>
<tr>
<td>user_agent</td>
<td>false</td>
<td>If given, the user agent will be saved in TicketJames and linked to this devise. It will be used for pretty naming the devise when no name is given. E.g: &#39;iPhone 9&#39; instead of &#39;unkwown device&#39;. Please provide the full user agent string, it will be parsed on the server.</td>
</tr>
<tr>
<td>type</td>
<td>true</td>
<td>The type (one of [&#39;company&#39;,&#39;project&#39;,&#39;event&#39;,&#39;group&#39;,&#39;location&#39;]) obtained from the QR code</td>
</tr>
<tr>
<td>id</td>
<td>true</td>
<td>The ID obtained from the QR code</td>
</tr>
<tr>
<td>key</td>
<td>true</td>
<td>The <code>key</code> object from the QR code</td>
</tr>
</tbody></table>

<!-- <aside class="success">
Remember — a happy kitten is an authenticated kitten!
</aside>
 -->
<h2 id='get-a-list-of-projects-for-a-specific-barcode-scanner'>Get a list of projects for a specific Barcode Scanner</h2><pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.ticketjames.com/en/api/v1/barcode-scanners/65888ba4-9570-43e7-b701-71cb3f4d2549/projects"</span>
  -H <span class="s2">"Content-Type: application/json"</span>
  -H <span class="s2">"key: f1f604bc31f98cc0544853cd48bc90c6"</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo Project"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
        </span><span class="s2">"starts_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 20:00:00 +0200"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opening night"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total_tickets"</span><span class="p">:</span><span class="w"> </span><span class="mi">245</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total_scanned"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
        </span><span class="s2">"is_blocked"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 13:00:00 +0200"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 23:00:00 +0200"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">457</span><span class="p">,</span><span class="w">
        </span><span class="s2">"starts_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 20:00:00 +0200"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VIP night"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total_tickets"</span><span class="p">:</span><span class="w"> </span><span class="mi">212</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total_scanned"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"is_blocked"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 13:00:00 +0200"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 23:00:00 +0200"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint retrieves a list of projects and events.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET https://api.ticketjames.com/&lt;LOCALE&gt;/api/v1/barcode-scanners/&lt;DEVICE-UID&gt;/projects</code></p>
<h3 id='url-parameters'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>UID</td>
<td>The UID of an already registered devise.</td>
</tr>
</tbody></table>

<aside class="warning">
When a barcode scanner is not registered, the server will return a <code>http 404 not found</code> message.
</aside>
<h3 id='return-message'>Return message</h3>
<p>The JSON response contains a list of <code>projects</code>, each containing one ore more <code>events</code>.</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Unique event ID</td>
</tr>
<tr>
<td>starts_at</td>
<td>Start time of the event</td>
</tr>
<tr>
<td>name</td>
<td>(localized) name of the event</td>
</tr>
<tr>
<td>total_tickets</td>
<td>The total number of valid tickets for this event</td>
</tr>
<tr>
<td>total_scanned</td>
<td>The total number of tickets already scanned</td>
</tr>
<tr>
<td>is_blocked</td>
<td>Returns <code>false</code> by default, but can be <code>true</code> if the scanning device is blocked by the project owner.</td>
</tr>
<tr>
<td>scannable_from</td>
<td>Tickets can be scanned later than given time</td>
</tr>
<tr>
<td>scannable_until</td>
<td>Tickets can be scanned until given time</td>
</tr>
</tbody></table>
<h2 id='get-a-list-of-scannable-barcodes-for-a-specific-barcode-scanner'>Get a list of scannable barcodes for a specific Barcode Scanner</h2><pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.ticketjames.com/en/api/v1/barcode-scanners/65888ba4-9570-43e7-b701-71cb3f4d2549/tickets?since=1529412079"</span>
-H <span class="s2">"Content-Type: application/json"</span>
-H <span class="s2">"key: f1f604bc31f98cc0544853cd48bc90c6"</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2564</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 13:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 23:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"291211"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opening Night - 1 Adult"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Row 3, seat 12"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"valid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2565</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 13:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 23:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"034255"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opening Night - 1 Child"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Row 7, seat 8"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scanned"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3216</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">457</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 13:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 23:00:00 +0200"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"655779"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vip Night - 1 Adult"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wheelchair - Row 2, seat 12"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"canceled"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This endpoint requests a list of known tickets that can be scanned by the given barcode scanner.</p>

<p>Use this request every time you want to synchronize tickets from the server to your mobile device (barcode scanner). When this endpoint is called without the <code>since</code> parameter, the response JSON will containt <strong>all available</strong> tickets. This can potentially be a very, very large list, e.gl: thousands of records.</p>

<p>Therefore, you will probably only want to call this endpoint just the first time. When you call the endpoint <strong>with</strong> the <code>since</code> parameter, the resulting JSON will only contain tickets that have been changed since the given time:
 - New tickets
 - Tickets with changed details (seat number, title, etc.)
 - Tickets with changed status (valid -&gt; scanned, or valid -&gt; canceled)</p>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>GET https://api.ticketjames.com/&lt;LOCALE&gt;/api/v1/barcode-scanners/&lt;DEVICE-UID&gt;/tickets?since=&lt;UNIX-TIMESTAMP&gt;</code></p>
<h3 id='url-parameters-2'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>locale</td>
<td>false</td>
<td>The requested locale for titles and descriptions.</td>
</tr>
<tr>
<td>UID</td>
<td>true</td>
<td>The UID of an already registered devise.</td>
</tr>
<tr>
<td>since</td>
<td>false</td>
<td>A timestamp in <a target="_blank" href="https://www.unixtimestamp.com/">Unix format</a> (seconds since epoch).</td>
</tr>
</tbody></table>

<aside class="notice">
Please note that the 'barcode' attribute is of type String, even though it is always a number. The reason for this, is that the first digit of a barcode can be a '0'. Storing these numbers as Integer will result in unexpected errors.
</aside>
<h2 id='submit-local-scan-actions'>Submit local scan actions</h2><pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.ticketjames.com/en/api/v1/barcode-scanners/65888ba4-9570-43e7-b701-71cb3f4d2549/scan"</span>
-X POST
-d <span class="s1">'{"barcodes":["123456", "789012"]'</span> 
-H <span class="s2">"Content-Type: application/json"</span>
-H <span class="s2">"key: f1f604bc31f98cc0544853cd48bc90c6"</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"123456"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scanned"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ticket"</span><span class="p">:{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2565</span><span class="p">,</span><span class="w">
      </span><span class="s2">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
      </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 13:00:00 +0200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-19 23:00:00 +0200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opening Night - 1 Child"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Row 4, seat 8"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scanned"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"789012"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"655779"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_time"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ticket"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2565</span><span class="p">,</span><span class="w">
      </span><span class="s2">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
      </span><span class="s2">"scannable_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 13:00:00 +0200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"scannable_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-06-20 23:00:00 +0200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"034255"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Opening Night - 1 Child"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Row 7, seat 8"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"valid"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Use this endpoint to send a batch of barocdes to the API. Both valid and invalid barcodes can be sent. The API will generate and return a response for each barcode and return an JSON Array containing all the responses.</p>

<aside class="notice">
Even if you are making a 'scan' request for every ticket scanned, the `barcodes` parameter should be an Array (of 1 object, in that case).
</aside>
<h3 id='suggested-workflow'>Suggested workflow</h3>
<p>The suggested workflow is to sync <strong>asynchronously</strong> and to sync <strong>often</strong>. Every time you scan a ticket locally, just check it with your local database. You should be able to assume it is up to date (you are the one who should make sure of that).</p>
<h3 id='what-if-a-ticket-is-scanned-on-the-device-but-not-found-in-the-database'>What if a ticket is scanned on the device, but not found in the database?</h3>
<p>This would be a good time to make a call to this endpoint and check the status for this barcode. Maybe it has just been purchased and your database isn&#39;t up to date yet. </p>
<h3 id='http-request-4'>HTTP Request</h3>
<p><code>GET https://api.ticketjames.com/&lt;LOCALE&gt;/api/v1/barcode-scanners/&lt;DEVICE-UID&gt;/scan</code></p>
<h3 id='url-parameters-3'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>locale</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>UID</td>
<td>true</td>
<td>The UID of an already registered devise.</td>
</tr>
</tbody></table>
<h3 id='query-parameters-2'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>barcodes</td>
<td>true</td>
<td>An array of barcodes to sync back to the server.</td>
</tr>
</tbody></table>
<h3 id='possible-status-messages'>Possible status messages</h3>
<table><thead>
<tr>
<th>Message</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>success</td>
<td>The ticket will be marked as scanned. OK!</td>
</tr>
<tr>
<td>already_scanned</td>
<td>This ticket has already been scanned.</td>
</tr>
<tr>
<td>canceled</td>
<td>This ticket used to be valid, but has been canceled.</td>
</tr>
<tr>
<td>invalid</td>
<td>No tickets found with this barcode. Is your device registered for this project?</td>
</tr>
<tr>
<td>invalid_time</td>
<td>This tickets is valid, but the scan time isn&#39;t within the limits of &#39;scannable_from&#39; and &#39;scannable_until&#39;. The ticket <strong>will not be marked as scanned</strong>.</td>
</tr>
</tbody></table>
<h1 id='errors'>Errors</h1>
<p>TicketJames API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your credentials are wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed -- You tried to access an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable -- You requested a format that isn&#39;t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone -- The requested object has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I&#39;m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests -- You&#39;re making too many requests! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>
<h1 id='changelog'>Changelog</h1><h3 id='2018-06-24'>2018/06/24</h3>
<ul>
<li>A &#39;key&#39; header for authentication is now needed for all communication. </li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
